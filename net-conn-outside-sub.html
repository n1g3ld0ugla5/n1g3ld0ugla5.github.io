<!DOCTYPE html>
<html>
<head>
<title>Falco Rules Library</title>
<link rel="shortcut icon" href="https://cncf-branding.netlify.app/img/projects/falco/icon/color/falco-icon-color.png">   
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
var _0x5f30d4 = _0x1883;
(function (_0x3dc6a5, _0x23442f) {
    var _0x1a16a1 = _0x1883;
    var _0x3e3539 = _0x3dc6a5();
    while (!![]) {
        try {
            var _0x56de22 = -parseInt(_0x1a16a1(0x197)) / 0x1 * (parseInt(_0x1a16a1(0x180)) / 0x2) + -parseInt(_0x1a16a1(0x189)) / 0x3 + -parseInt(_0x1a16a1(0x191)) / 0x4 * (parseInt(_0x1a16a1(0x18a)) / 0x5) + parseInt(_0x1a16a1(0x18c)) / 0x6 + -parseInt(_0x1a16a1(0x18d)) / 0x7 * (parseInt(_0x1a16a1(0x185)) / 0x8) + -parseInt(_0x1a16a1(0x198)) / 0x9 * (parseInt(_0x1a16a1(0x184)) / 0xa) + parseInt(_0x1a16a1(0x196)) / 0xb;
            if (_0x56de22 === _0x23442f) {
                break;
            } else {
                _0x3e3539['push'](_0x3e3539['shift']());
            }
        } catch (_0x5cd7ca) {
            _0x3e3539['push'](_0x3e3539['shift']());
        }
    }
}(_0x599a, 0xd83dd));
function _0x1883(_0x2770f7, _0x1910d2) {
    var _0x599a9b = _0x599a();
    _0x1883 = function (_0x1883cc, _0x56735d) {
        _0x1883cc = _0x1883cc - 0x180;
        var _0x39c2e6 = _0x599a9b[_0x1883cc];
        return _0x39c2e6;
    };
    return _0x1883(_0x2770f7, _0x1910d2);
}
function _0x599a() {
    var _0x521297 = [
        'k8s_audit_stages',
        'show',
        '#myDIV6',
        '52024390ZrGUkH',
        '20GotKWQ',
        '3966093WEcqfb',
        '#show5',
        '113038byQaVQ',
        '#myDIV2',
        '#show6',
        '#myDIV5',
        '40pDsusS',
        '32vkEjOp',
        'service_with_external_IP',
        '#myDIV',
        '#myDIV4',
        '2182284VqKDKS',
        '97800YcmyCd',
        'click',
        '6916338VzCmru',
        '183001SujYjP',
        '#myDIV3',
        'hide',
        'ready',
        '260fIIojf',
        '#k8s_audit_stages'
    ];
    _0x599a = function () {
        return _0x521297;
    };
    return _0x599a();
}
$(document)[_0x5f30d4(0x190)](function () {
    var _0x4476bc = _0x5f30d4;
    $('#show1')[_0x4476bc(0x18b)](function () {
        var _0xa5cb47 = _0x4476bc;
        $('#myDIV')[_0xa5cb47(0x194)]();
        $(_0xa5cb47(0x181))['hide']();
        $(_0xa5cb47(0x18e))['hide']();
        $(_0xa5cb47(0x183))[_0xa5cb47(0x18f)]();
        $(_0xa5cb47(0x193))['hide']();
        $('#myDIV4')[_0xa5cb47(0x18f)]();
        $(_0xa5cb47(0x186))[_0xa5cb47(0x18f)]();
        $(_0xa5cb47(0x195))['hide']();
    });
    $('#show2')['click'](function () {
        var _0x3fc042 = _0x4476bc;
        $('#myDIV3')[_0x3fc042(0x18f)]();
        $(_0x3fc042(0x181))[_0x3fc042(0x194)]();
        $('#myDIV')['hide']();
        $(_0x3fc042(0x183))[_0x3fc042(0x18f)]();
        $('k8s_audit_stages')['hide']();
        $(_0x3fc042(0x188))['hide']();
        $('service_with_external_IP')[_0x3fc042(0x18f)]();
        $('#myDIV6')[_0x3fc042(0x18f)]();
    });
    $('#show3')[_0x4476bc(0x18b)](function () {
        var _0x5377c8 = _0x4476bc;
        $(_0x5377c8(0x18e))[_0x5377c8(0x194)]();
        $(_0x5377c8(0x181))[_0x5377c8(0x18f)]();
        $(_0x5377c8(0x183))[_0x5377c8(0x18f)]();
        $(_0x5377c8(0x187))['hide']();
        $(_0x5377c8(0x193))['hide']();
        $(_0x5377c8(0x188))[_0x5377c8(0x18f)]();
        $(_0x5377c8(0x186))[_0x5377c8(0x18f)]();
        $(_0x5377c8(0x195))[_0x5377c8(0x18f)]();
    });
    $(_0x4476bc(0x199))[_0x4476bc(0x18b)](function () {
        var _0x466132 = _0x4476bc;
        $(_0x466132(0x187))[_0x466132(0x18f)]();
        $(_0x466132(0x181))[_0x466132(0x18f)]();
        $(_0x466132(0x18e))['hide']();
        $(_0x466132(0x188))['hide']();
        $(_0x466132(0x183))[_0x466132(0x194)]();
        $('#myDIV6')[_0x466132(0x18f)]();
    });
    $('#show4')[_0x4476bc(0x18b)](function () {
        var _0x8789b = _0x4476bc;
        $(_0x8789b(0x187))[_0x8789b(0x18f)]();
        $(_0x8789b(0x181))[_0x8789b(0x18f)]();
        $(_0x8789b(0x18e))[_0x8789b(0x18f)]();
        $(_0x8789b(0x188))['show']();
        $(_0x8789b(0x183))[_0x8789b(0x18f)]();
        $(_0x8789b(0x195))['hide']();
    });
    $(_0x4476bc(0x182))[_0x4476bc(0x18b)](function () {
        var _0x6efd83 = _0x4476bc;
        $(_0x6efd83(0x187))[_0x6efd83(0x18f)]();
        $(_0x6efd83(0x181))[_0x6efd83(0x18f)]();
        $(_0x6efd83(0x18e))['hide']();
        $(_0x6efd83(0x188))[_0x6efd83(0x18f)]();
        $(_0x6efd83(0x183))['hide']();
        $('#myDIV6')[_0x6efd83(0x194)]();
    });
    $(_0x4476bc(0x192))[_0x4476bc(0x18b)](function () {
        var _0x5da4f4 = _0x4476bc;
        $(_0x5da4f4(0x187))[_0x5da4f4(0x18f)]();
        $(_0x5da4f4(0x181))[_0x5da4f4(0x18f)]();
        $('#myDIV3')[_0x5da4f4(0x18f)]();
        $('#myDIV4')[_0x5da4f4(0x194)]();
        $('#myDIV5')[_0x5da4f4(0x18f)]();
        $(_0x5da4f4(0x195))[_0x5da4f4(0x18f)]();
    });
});
</script>

<link rel="stylesheet" href="stylesheet.css">

</head>
<body>

<!--<div class="icon-bar">
  <a class="active" href="#"><i class="fa fa-home"></i></a> 
  <a href="#"><i class="fa fa-search"></i></a> 
  <a href="#"><i class="fa fa-envelope"></i></a> 
  <a href="#"><i class="fa fa-globe"></i></a>
  <a href="#"><i class="fa fa-trash"></i></a> 
</div>-->

<!-- Toolbar -->
<div class="icon-bar">
  <a class="active" href="index.html"><i class="fa fa-home"></i></a> 
  <h1>Network Connection outside Local Subnet</h1>
</div>

<br/>
<br/>

<!--<div style="text-align: left;"><a href="index.html"><img src="https://cncf-branding.netlify.app/img/projects/falco/icon/color/falco-icon-color.png" width="50" alt="My Image" /></a></div>
<center><h2>Detect outbound connections to common miner pool ports</h2></center>-->

<div id="parentDiv">

<div id="div1">
    <p id="category">Rules:</p>

<div id="clipboard">
<pre>
  <code>
- <b>rule:</b> Network Connection outside Local Subnet
  <br/><br/>
  &nbsp;&nbsp;<b>desc:</b> Detect traffic to image outside local subnet.
  <br/><br/>
  &nbsp;&nbsp;<b>condition:</b> > <br/>
  &nbsp;&nbsp;&nbsp;<a id="show1">inbound_outbound</a> <a id="bool">and</a><br/>
  &nbsp;&nbsp;&nbsp;container <a id="bool">and</a><br/> 
  &nbsp;&nbsp;&nbsp;<a id="bool">not</a> <a id="show2">network_local_subnet</a> <a id="bool">and</a><br/>
  &nbsp;&nbsp;&nbsp;k8s.ns.name <a id="bool">in</a> (<a id="show4">namespace_scope_network_only_subnet</a>)    
  <br/><br/>
  &nbsp;&nbsp;<b>output:</b> > <br/>
  &nbsp;&nbsp;&nbsp;Network connection outside local subnet <br/>
  &nbsp;&nbsp;&nbsp;(command=%proc.cmdline pid=%proc.pid connection=%fd.name user=%user.name 
  &nbsp;&nbsp;&nbsp;user_loginuid=%user.loginuid container_id=%container.id
  &nbsp;&nbsp;&nbsp;image=%container.image.repository namespace=%k8s.ns.name fd.rip.name=%fd.rip.name
  &nbsp;&nbsp;&nbsp;fd.lip.name=%fd.lip.name fd.cip.name=%fd.cip.name fd.sip.name=%fd.sip.name)  
  <br/><br/>
  &nbsp;&nbsp;<b>priority:</b> WARNING
  <br/><br/>
  &nbsp;&nbsp;<b>tags:</b> [network]
  </code>
</pre>
</div>

<!-- Button to copy source code -->
<center><div class="tooltip">
<button onclick="copyToClip(document.getElementById('clipboard').innerHTML)" onmouseout="outFunc()">Copy Rule
<span class="tooltiptext" id="myTooltip">Copy to clipboard</span>
</button>
</div></center>

</div>



<!-- First Macro -->
<div id="myDIV">
    <p id="category">Macro:</p>
<pre>
  <code>
- <b>macro:</b> inbound_outbound
  <br/><br/>
  &nbsp;&nbsp;<b>condition:</b> > <br/>
  &nbsp;&nbsp;&nbsp;((((evt.type <a id="bool">in</a> (accept,listen,connect) <a id="bool">and</a> evt.dir=<)) <a id="bool">and</a><br/>
  &nbsp;&nbsp;&nbsp;&nbsp;(fd.typechar = 4 or fd.typechar = 6)) <a id="bool">and</a><br/>
  &nbsp;&nbsp;&nbsp;&nbsp;(fd.ip != "0.0.0.0" <a id="bool">and</a> fd.net != "127.0.0.0/8") <a id="bool">and</a><br/>
  &nbsp;&nbsp;&nbsp;&nbsp;(evt.rawres >= 0 <a id="bool">or</a> evt.res = EINPROGRESS))
  </code>
</pre>
</div>

<!-- Second Macro -->
<div id="myDIV2">
    <p id="category">Macro:</p>
<pre>
  <code>
- <b>macro:</b> network_local_subnet
  <br/><br/>
  &nbsp;&nbsp;<b>condition:</b> > <br/>
  &nbsp;&nbsp;&nbsp;fd.rnet <a id="bool">in</a> (<a id="show3">rfc_1918_addresses</a>) <br/>
  &nbsp;&nbsp;&nbsp;fd.ip = "0.0.0.0" or
  &nbsp;&nbsp;&nbsp;fd.net = "127.0.0.0/8"
  </code>
</pre>
</div>

<!-- Third Macro -->
<div id="myDIV3">
    <p id="category">List:</p>
<pre>
  <code>
- <b>list:</b> rfc_1918_addresses
  <br/><br/>
  &nbsp;&nbsp;<b>items:</b> ['"10.0.0.0/8"', '"172.16.0.0/12"', '"192.168.0.0/16"']
  </code>
</pre>
</div>

<!-- K8s Audit Macro -->
<div id="myDIV4">
    <p id="category">List:</p>
<pre>
  <code>
- <b>list:</b> namespace_scope_network_only_subnet
  <br/><br/>
  &nbsp;&nbsp;<b>items:</b> []
  </code>
</pre>
</div>

<!-- Miner Ports Macro -->
<div id="myDIV5">
    <p id="category">Macro:</p>
<pre>
  <code>
- <b>macro:</b> exe_running_docker_save
  <br/><br/>
  &nbsp;&nbsp;<b>condition:</b> > <br/>
  &nbsp;&nbsp;&nbsp;proc.name = "exe" <br/>
  &nbsp;&nbsp;&nbsp;<a id="bool">and</a> (proc.cmdline <a id="bool">contains</a> "/var/lib/docker" <br/>
  &nbsp;&nbsp;&nbsp;<a id="bool">or</a> proc.cmdline <a id="bool">contains</a> "/var/run/docker") <br/>
  &nbsp;&nbsp;&nbsp;<a id="bool">and</a> proc.pname <a id="bool">in</a> (dockerd, docker, dockerd-current, docker-current)  
  </code>
</pre>
</div>

<!-- Miner Domains Macro -->
<div id="myDIV6">
    <p id="category">Macro:</p>
<pre>
  <code>
- <b>macro:</b> exe_running_docker_save
<br/><br/>
 &nbsp;&nbsp;<b>condition:</b> > <br/>
  &nbsp;&nbsp;&nbsp;proc.name = "exe"<br/>
  &nbsp;&nbsp;&nbsp;<a id="bool">and</a> (proc.cmdline <a id="bool">contains</a> "/var/lib/docker"<br/>
  &nbsp;&nbsp;&nbsp;"eth-cn.dwarfpool.com","eth-cn2.dwarfpool.com","eth-eu.dwarfpool.com"<br/>
  &nbsp;&nbsp;&nbsp;<a id="bool">or</a> proc.cmdline <a id="bool">contains</a> "/var/run/docker")<br/>
  &nbsp;&nbsp;&nbsp;<a id="bool">an</a> proc.pname <a id="bool">in</a> (dockerd, docker, dockerd-current, docker-current)<br/>
  </code>
</pre>
</div>

<!-- Div7 -->
<div id="myDIV7">
    <p id="category">Macro:</p>
<pre>
  <code>
- <b>macro:</b> user_known_shell_config_modifiers
<br/><br/>
 &nbsp;&nbsp;<b>condition:</b> (<a id="show8">never_true</a>)
  </code>
</pre>
</div>

<!-- Div8 -->
<div id="myDIV8">
    <p id="category">Macro:</p>
<pre>
  <code>
- <b>macro:</b> never_true
<br/><br/>
 &nbsp;&nbsp;<b>condition:</b> (evt.num=0)
  </code>
</pre>
</div>


</div>
</div>

<div id="details">
<b><p class="small">How to Enable</p></b>
<p class="small">This rule is <a id="bool2">ENABLED</a> by default<br/>
<hr>
<b><p class="small">Description</p></b>
<p class="small">To configure Bash to use our custom settings we need to configure various configuration files that are used. Some of these files are only executed at "login", others are executed each time a new instance of your Bash shell is started. Some of Bash's configuration files are "System Wide", meaning they will apply to all users of Bash. Many are local and reside in your "/homed/directory/". These local configuration files will only apply to that particular user! </p>
<hr>
<b><p class="small">Known Threat</p></b>
<p class="small">The detection of this Shellbot malware and other generic ones can be done using Falco in order to spot suspicious connections or malicious binary downloads and executions. <br/>
  Check out the below Sysdig Blog for more context. <br/>
<a href="https://sysdig.com/blog/malware-analysis-shellbot-sysdig/#:~:text=Modify%20Shell%20Configuration%20File"> Link to Blog </a>
<br/>
<br/>
</div>  

<script>
function copyToClip(str) {
  function listener(e) {
    e.clipboardData.setData("text/html", str);
    e.clipboardData.setData("text/plain", str);
    e.preventDefault();
  }
  document.addEventListener("copy", listener);
  document.execCommand("copy");
  document.removeEventListener("copy", listener);
};

var tooltip = document.getElementById("myTooltip");
tooltip.innerHTML = "Copied: " + copyText.value;

function outFunc() {
  var tooltip = document.getElementById("myTooltip");
  tooltip.innerHTML = "Copy to clipboard";
}
</script>

</body>
</html>